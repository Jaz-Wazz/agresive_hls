<html>
	<head>
		<link rel="stylesheet" href="main.css">
		<script src="hls.js"></script>
	</head>
	<body>
		<video id="player" controls="controls"></video>
		<textarea spellcheck="false"></textarea>
	</body>
	<script>
		class Loader extends Hls.DefaultConfig.loader
		{
			constructor(config)
			{
				super(config);
				var load = this.load.bind(this);

				this.load = async function(context, config, callbacks)
				{
					let url = new URL(context.url);
					let filename = url.pathname.split('/').pop();
					let index = parseInt(filename.match(/\d+/)[0]);

					console.log('Load segment: [Index: %i, Url: %s].', index, url.toString());
					let response = await fetch(url);
					let buf = await response.arrayBuffer();
					callbacks.onSuccess({data: buf}, {}, context);
				};
			}
		};

		let hls = new Hls({fLoader: Loader, enableWorker: true});
		hls.loadSource('http://ia801502.s3dns.us.archive.org/e664bc09/index-muted-T1IWW6BKPV.m3u8');
		hls.attachMedia(player);
	</script>
</html>
